#!/usr/bin/env dash

ansi_escape='\x1B\[[0-9;]*[JKmsu]'
# example: 2020-02-22 19:43:20
msg_prefix='^[0-9][0-9][0-9][0-9]-[0-1][0-9]-[0-3][0-9] [0-2][0-9]:[0-5][0-9]:[0-5][0-9]\s*'
nick_prefix='\+|%|@'
bots='ShinyMetal|mockturtle|weebot|gonzobot|SubWatch|JARVIS|Internets|YT-info'
channel_noise() {
	for file in "$WEECHAT_HOME/logs/"irc.*.[#]*.weechatlog; do
		echo "$(basename "$file") $(
			sed -e "s/$ansi_escape//g" -e "s/$msg_prefix//" "$file" \
				| grep -Ecv "^(\-\->?|<\-\-|($nick_prefix)?($bots))\s"
		)"
	done
}

channel_noise | sort -n -k 2 -r | nl
# vi:ft=sh
