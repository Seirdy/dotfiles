# tiling WM = no need for border
border=no
# disable pseudo-titlebar (v0.31+). keyboard shortcuts obsolete window buttons
script-opts=osc-windowcontrols=no
term-osd-bar
load-scripts=yes
osd-font=Source Sans Pro
hwdec=vaapi-copy
hwdec-codecs=all
gpu-context=wayland # SwayWM
cache=yes
pulse-buffer=50
dither-depth=auto
temporal-dither=yes

# Subtitles/languages
# blend-subtitles=yes
sub-font='Noto Sans Semibold' # supports max unicode
sub-font-size=45
sub-auto=fuzzy
audio-file-auto=fuzzy
sub-file-paths-append=ass
sub-file-paths-append=srt
sub-file-paths-append=sub
sub-file-paths-append=subs
sub-file-paths-append=Subs
sub-file-paths-append=subtitles
sub-color=0.9/0.7
sub-back-color=0.0/0.15
sub-blur=5.0
sub-ass-hinting=light
sub-ass-force-style=Kerning=yes # dear god i hate unkerned subs
slang=en,eng,english,enUS
alang=en,eng,english,enUS # Anime profile overrides this

# screenshots
screenshot-format=png
screenshot-template=mpv-shot-%f-%p-%n
screenshot-tag-colorspace=yes
screenshot-high-bit-depth=yes
screenshot-png-compression=9
screenshot-directory=~/Pictures/mpv

# I typically watch videos sped-up.
# My profile for high-quality movies switches back to 1x speed, since
# speeding up films can mess with the pacing/storytelling and the
# soundtrack.
# Otherwise, I speed up standard movies/TV to match a 30hz NTSC refresh
# rate, avoiding framedrop. "30hz" actually means a 30/1.001 refresh
# rate, but film is often played at 4/5 that. 1.001/0.8=1.25125
speed=1.25125
# speed=2

############
# Profiles #
############

[mid-quality]
profile=gpu-hq
gpu-api=opengl

# high-quality will cause massive stuttering if you don't have high-end
# hardware that supports Vulkan hardware-accelerated decoding.
[high-quality]
profile-desc="Max quality for high-end hardware"
# vulkan
profile=mid-quality
gpu-context=waylandvk
gpu-api=vulkan
fbo-format=rgba16hf
vulkan-async-transfer=yes
vulkan-async-compute=yes
vd-lavc-threads=16
glsl-shaders="~~/shaders/mpv-prescalers/ravu-zoom-r4-yuv.hook"

scale=ewa_lanczossharp
glsl-shaders-append="~~/shaders/SSimDownscaler.glsl"
dscale=mitchell
linear-downscaling=yes
# chroma upscaling and downscaling
glsl-shaders-append="~~/shaders/KrigBilateral.glsl"
cscale=mitchell
sigmoid-upscaling=yes
correct-downscaling=yes
scale-antiring=0.7
dscale-antiring=0.7
cscale-antiring=0.7
# interpolation
video-sync=display-resample
interpolation=yes
tscale=box
tscale-window=quadric
tscale-radius=1.025
tscale-clamp=0.0
interpolation-threshold=0.01

hls-bitrate=max
demuxer-max-bytes=500000000
demuxer-max-back-bytes=250000000
demuxer-cache-wait=no
hwdec-extra-frames=60
ytdl-format='bestvideo[width>1920][ext=webm]+bestaudio[ext=webm]/bestvideo[width>1920]+bestaudio/bestvideo[ext=webm]+bestaudio[ext=webm]/bestvideo+bestaudio/best'

[low-quality]
profile-desc="Low quality for minimum resources"
gpu-api=opengl
scale=bilinear

[default]
profile=mid-quality

# profiles for specific use-cases

[podcast]
profile=low-quality
speed=2.05
save-position-on-quit
audio-display=no

# I sometimes play music over the network using rclone
# caching is important.
[music]
cache=yes
profile=low-quality
speed=1
audio-display=no
demuxer-readahead-secs=30
demuxer-seekable-cache=yes
prefetch-playlist=yes
demuxer-cache-wait=yes
demuxer-max-bytes=35MiB
demuxer-max-back-bytes=1MiB
autoload-files=yes

[movie]
profile=mid-quality
speed=1
fullscreen=yes
save-position-on-quit=yes

[movie-hq]
profile=high-quality
speed=1 # don't ruin pacing/soundtrack
fullscreen=yes
save-position-on-quit=yes

[anime]
profile=movie
glsl-shaders-clr
alang=ja,jp,jpn,japanese,en,eng,english
dscale=mitchell
cscale=mitchell
glsl-shaders="~~/shaders/Anime4K_Hybrid_Fast.glsl"
ytdl-format=best[height<1080]

[anime-hq]
profile=movie-hq
glsl-shaders-clr

alang=ja,jp,jpn,japanese,en,eng,english
blend-subtitles # needed for interpolation
sub-fix-timing=yes

# lavfi filters: denoise, drop duplicate frames
vf=lavfi="mpdecimate=max=2:frac=0.75,hqdn3d=luma_spatial=5"
glsl-shaders='~~/shaders/Anime4K_Hybrid.glsl'
deband=yes
deband-iterations=4
deband-threshold=50
deband-range=16
deband-grain=0
ytdl-format=best[height<1080]

[protocol.http]
demuxer-seekable-cache=yes
[protocol.https]
profile=protocol.http
[protocol.ytdl]
profile=protocol.http

# images
# Because hardware-acccelerated Vulkan-based image decoding is important
# and definetly not a waste of my time.
# The upscaling filters are useful I guess.

[image]
gpu-context=waylandvk
gpu-api=vulkan
fbo-format=rgba16hf
vulkan-async-transfer=yes
vulkan-async-compute=yes
scale=ewa_lanczossharp
cscale=ewa_lanczossharp
correct-downscaling=yes
osc=no
sub-auto=no
audio-file-auto=no
term-status-msg=
image-display-duration=inf
loop-file=inf
mute=yes
loop-playlist=inf
pause

[extension.png]
profile=image
video-aspect-override=no

[extension.jpg]
profile=image
video-aspect-override=no

[extension.jpeg]
profile=extension.jpg

[extension.webp]
profile=image

[manga]
profile=image
glsl-shaders='~~/shaders/Anime4K_Adaptive.glsl'

# the syntax isn't really TOML but it's a good approximation
# vi:ft=toml
